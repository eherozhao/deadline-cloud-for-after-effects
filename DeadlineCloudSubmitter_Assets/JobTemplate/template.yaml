specificationVersion: jobtemplate-2023-09
name:  {{JOBNAME}}
description: >
  A simple job bundle that allows a user to select a project and comp to render with aerender.
parameterDefinitions:
  - name: ProjectFile
    type: PATH
    objectType: FILE
    dataFlow: IN
    userInterface:
      control: CHOOSE_INPUT_FILE
      label: Project file
      groupLabel: Source
      fileFilters:
        - label: After Effects project files
          patterns:
            - '*.aep'
            - '*.aepx'
        - label: All Files
          patterns:
            - '*'
    description: The After Effects project file to render.
  - name: RenderQueueIndex
    type: INT
    userInterface:
      control: SPIN_BOX
      label: Render Queue Index
      groupLabel: Source
    description: The index of the item in the render queue to render.
    default: 1
  - name: OutputFiles
    type: PATH
    objectType: FILE
    dataFlow: OUT
    userInterface:
      control: HIDDEN
      label: Output File(s)
      groupLabel: Frame Range
    default: ~\Desktop\output
    description: The render output destination
  - name: FrameStarts
    type: STRING
    userInterface:
      control: LINE_EDIT
      label: Starting Frames
      groupLabel: Frame Range
    default: 1-10
  - name: FrameEnds
    type: STRING
    userInterface:
      control: LINE_EDIT
      label: Ending Frames
      groupLabel: Frame Range
    default: 1-10
  - name: MultiFrameMaxCPU
    type: INT
    userInterface:
      control: SPIN_BOX
      label: Multi-Frame Max CPU Percentage
      groupLabel: Source
    description: The maximum percentage of the CPU Multi-Frame Rendering is allowed to use. Set to 0 to disable Multi-Frame Rendering. Max is 100.
    default: 90

  # Hidden Controls
  - name: JobScriptDir
    description: Directory containing embedded scripts.
    userInterface:
      control: HIDDEN
    type: PATH
    objectType: DIRECTORY
    dataFlow: IN
    default: scripts

jobEnvironments:
  - name: 'Create Output Directories'
    description: 'Create Output Directories'
    script:
      actions:
        onEnter:
          command: powershell
          args:
            - "-File"
            - "{{Param.JobScriptDir}}/start.ps1"
            - "{{Param.OutputFiles}}"

steps:
  - name: Call AERender
    parameterSpace:
      taskParameterDefinitions:
      - name: FrameStart
        type: INT
        range: '{{Param.FrameStarts}}'
      - name: FrameEnd
        type: INT
        range: '{{Param.FrameEnds}}'
      combination: "(FrameStart, FrameEnd)"
    script:
      actions:
        onRun:
          command: powershell
          args:
            - "-File"
            - "{{Param.JobScriptDir}}/aerender.ps1"
            - '{{Param.ProjectFile}}'
            - '{{Param.RenderQueueIndex}}'
            - '{{Task.Param.FrameStart}}'
            - '{{Task.Param.FrameEnd}}'
            - '{{Param.MultiFrameMaxCPU}}'
            - '{{Param.OutputFiles}}'
